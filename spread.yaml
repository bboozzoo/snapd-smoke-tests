project: snapd-smoke-tests
path: /root/snapd-smoke-tests
exclude:
  - .image-garden
  - .git
prepare: |
  # apt update
  # apt dist-upgrade -y
  echo nothing
restore: |
  echo nothing
backends:
  garden:
    type: adhoc
    allocate: |
        if [ -n "${SPREAD_HOST_PATH-}" ]; then
            PATH="$SPREAD_HOST_PATH"
        fi
        mkdir -p .image-garden/cache/"$SPREAD_SYSTEM.$(uname -m)"
        exec image-garden allocate \
          "$SPREAD_SYSTEM"."$(uname -m)" \
          -virtfs local,mount_tag=cache,id=cache,path=$(pwd)/.image-garden/cache/"$SPREAD_SYSTEM.$(uname -m)",security_model=mapped
    discard: |
        if [ -n "${SPREAD_HOST_PATH-}" ]; then
            PATH="$SPREAD_HOST_PATH"
        fi
        export QEMU_MEM_OPTION='-m 1024'
        exec image-garden discard "$SPREAD_SYSTEM_ADDRESS"
    systems:
      - ubuntu-cloud-24.04:
          username: ubuntu
          password: ubuntu
      - debian-cloud-11:
          username: debian
          password: debian
      - debian-cloud-12:
          username: debian
          password: debian
      - centos-cloud-9:
          username: fedora
          password: fedora
      - fedora-cloud-41:
          username: fedora
          password: fedora
      - fedora-cloud-42:
          username: fedora
          password: fedora
      - opensuse-cloud-tumbleweed:
          username: opensuse
          password: opensuse
suites:
  tests/server/:
    summary: ...
  tests/desktop/:
    summary: ...

